# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/styles/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
В начале необходимо проверить наличие файла .env с ключом API_ORIGIN указывающий на адрес сервера API:

```
API_ORIGIN=https://example.com
```
для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Архитектура проекта

Для создания эффективного и понятного приложения на базе упрощённой версии шаблона MVP (Model-View-Presenter), где вся логика управления централизованно сосредоточена в "Presenter", важно чётко определить механизм взаимодействия между компонентами приложения через события. Ниже приведено описание общей архитектуры приложения, списка событий и данных, передаваемых в рамках каждого события.

Основные компоненты:
1. Model - отвечает за управление данными (загрузка, изменение, сохранение).
2. View - отвечает за отображение информации пользователю и интерактив с пользователем.
3. Presenter - слой, который связывает Model и View. Обрабатывает события от View, вызывает изменения в Model и обновляет View.

Для описания товара используется интерфейс IProduct:

```typescript
interface IProduct {
	id: string;
	description: string;
	image: string;
	title: string;
	category: string;
	price: number | null;
}
```

Для определения возможных способов оплаты заказа используется тип `TOrderPayment`.

```typescript
type TOrderPayment = 'cash' | 'card';
```
Интерфейс `IOrder` используется для описания заказа.

```typescript
interface IOrder {
	items: IProduct[];
	payment: TOrderPayment;
	address: string;
	email: string;
	phone: string;
}
```
В процессе оформления заказа создаётся специальный объект типа `TOrderInvoice`, который используется для взаимодействия с API.

```typescript
type TOrderInvoice = Omit<IOrder, 'items'> & {
	items: string[];
	total: number;
};
```

Для отслеживания текущего этапа заказа используется тип `TOrderStep`:

```typescript
type TOrderStep = 'shipment' | 'contacts';
```

## Базовый код

### Базовый класс API

Осуществляет основные операции по обмену данными с серверным API, включая получение и отправку информации.
```typescript
type ApiPostMethods = 'POST' | 'PUT' | 'DELETE'
```
### Базовый класс EventEmitter

Реализует управление событиями, включая добавление и удаление обработчиков событий, а также их активацию при наступлении событий.
Класс реализует интерфейс `IEvents` и использует типы  `TSubscriber`, `TEmitterEvent` и `TEventName`.

```typescript
type TEventName = string | RegExp;

type TSubscriber = Function;

type TEmitterEvent = {
	eventName: string;
	data: unknown;
};

interface IEvents {
	on<T extends object>(event: TEventName, callback: (data: T) => void): void;
	emit<T extends object>(event: string, data?: T): void;
	trigger<T extends object>(
		event: string,
		context?: Partial<T>
	): (data: T) => void;
}
```

### Базовый абстрактный класс Model

Этот абстрактный класс определяет конструктор для всех моделей приложения. Он принимает аргументы, которые соответствуют частям данных дженерика, связанного с интерфейсом модели, и экземпляр брокера событий типа `Events`. Кроме того, класс содержит метод `emitChanges`, который использует `EventEmitter` для уведомления о любых изменениях в данных.

Имеет поля интерфейса IFormState
```typescript
interface IFormState {
	preview: IProduct;
	products: IProduct[];
	basket: Set<IProduct>;
	order: IOrder;
}
```

### Базовый абстрактный класс View

Абстрактный класс, определяющий конструктор для всех отображений приложения, а также метод `render`, который связывает DOM-элемент с отображением, используя определенные параметры `args`. Включает список событий, связанных с отображением, и брокер событий для передачи сообщений о внутренних событиях.

## Компоненты модели данных

### Класс ShopAPI

Специальный компонент для взаимодействия с API магазина отвечает за выполнение операций, связанных с получением списка товаров и оформлением заказа. Этот компонент наследуется от базового класса API и использует тип `TOrderInvoice` при оформлении заказа.

### Класс Catalog
Этот класс наследуется от базового класса Model и представляет модель для коллекции товаров на главной странице. Он используется для хранения и обработки данных о товарах. Внутри себя он хранит список объектов, которые поддерживают интерфейс `IProduct` (чтобы иметь доступ к их методам конвертации). При добавлении новых объектов в эту коллекцию генерируется событие 'catalog:items-changed', на которое реагируют другие компоненты, такие как Card и Page, для обновления списка карточек товаров.

### Класс Basket

Класс для отображения корзины, содержащий набор позиций корзины и их общую сумму, а также предоставляющий возможность выполнения действий при клике на кнопку оформления.

Используемые методы:
```typescript
// Добавляет товар в корзину
add(item: IProduct): void {}

// Удаляет товар из корзины по id
remove(id: string): void {}

// Проверяет, содержится ли товар с данным id в корзине
contains(id: string): boolean {}

// Возвращает массив id в виде строк
getIdList(): string[] {}

// Очищает корзину
clear(): void {}

// Возвращает массив объектов товаров из защищенного свойства items
get items(): IProduct[] {}

// Возвращает общую стоимость всех товаров в корзине
get total(): number {}

// Возвращает длину массива _items
get length(): number {}
```

### Класс Order
Этот класс представляет модель для заказа, используется для хранения и обработки данных о заказе.

Используемые методы:
```typescript
// Устанавливает способ оплаты
set payment(value: PaymentMethod): void {}

// Устанавливает адрес
set address(value: string): void {}

// Устанавливает email
set email(value: string): void {}

// Устанавливает номер телефона
set phone(value: string): void {}

// Устанавливает общую стоимость товаров в заказе
set total(value: number): void {}

// Устанавливает список товаров заказа в виде массива из id
set items(list: string[]): void {}

// Возвращает объект, подходящий для отправки в API post запросе
toApiObject(): IOrderData {}
```
## Компоненты представления

### Класс Modal
Наследуется от базового класса `View`.

Отображает модальное окно на странице. Он предоставляет методы для открытия и закрытия модального окна, а также управляет своим содержимым.

Имеет основной набор методов для управления состоянием модального окна:
```typescript
// Открыть модальное окно
open(): void{}
// Закрыть модальное окно
close(): void{}
```

### Класс Form
Наследуется от базового класса `View`.
Контролирует отображение ошибок валидации, обеспечивает прослушивание событий отправки формы и позволяет вносить изменения в поля формы.

Используемые методы:
```typescript
// Получение статуса валидности формы
get valid(): boolean {}

// Установка статуса валидности формы
set valid(value: boolean): void {}

// Установка текста ошибки
set error(value: string): void {}

// Очистка формы
clear(): void {}
```

### Класс Page
Наследуется от базового класса `View`.

Отображение самой страницы. Контролирует возможность скроллинга
Используемые методы:
```typescript
// Устанавливает значение в счетчике товаров корзины
set counter(value: string): void {}

// Блокирует или разблокирует прокрутку страницы
lockScroll(state: boolean): void {}
```




































